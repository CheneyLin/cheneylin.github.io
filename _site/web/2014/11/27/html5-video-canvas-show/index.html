
<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>HTML5实现视频的分离显示</title>
    <meta name="description" content="【技巧】HTML5实现视频的分离显示">
    <meta name="keyword" content="疯狂填字,芒果轻应用,麒麟工作室,林长宇,苹果开发者,推送,raywenderlich">
    <meta name="author" content="老林">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Sticky Footer -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bs-sticky-footer.css" rel="stylesheet">

    <!-- Custom styles -->
    <link href="/assets/themes/bootstrap-3/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
    <meta name="baidu-site-verification" content="MaCzy1slAM" />
  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><img src="/images/lcy.png" width="64" height="64">风雨雷电堂</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive.html">日志</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">分类</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/projects.html">项目</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">标签</a></li>
      	
      
    
  




          </ul>
          <form class="navbar-form navbar-right" role="search" action="http://zhannei.baidu.com/cse/search" method="get" target="_blank">
          <input type="hidden" name="s" value="10670906174234479444"> <input type="hidden" name="entry" value="1">
            <div class="form-group">
              <input name="q" type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default">Submit</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1>HTML5实现视频的分离显示 <small>【技巧】</small></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>2014年11月27日</span>
    </div>
    <div class="content">
      
<p>HTML5中的canvas可以实现很多图像、多媒体方面的功能，比如把视频的内容二次处理后在canvas上显示。</p>

<h2 id="drawimage">强大的drawImage</h2>

<pre><code>var video = document.querySelector('video');
var canvas1 = document.querySelector('#canvas1');
var ctx1 = canvas1.getContext('2d');
ctx1.drawImage(video, 0,0, 320, 180, 0,0, 320, 180);
</code></pre>

<p>完整代码</p>

<pre><code>&lt;html &gt;
&lt;head&gt;
&lt;meta charset="utf-8" /&gt;
&lt;title&gt;&lt;/title&gt;

&lt;/head&gt;
&lt;body&gt;
&lt;div style="position:absolute;"&gt;
    &lt;input type="button" id="play" value="play"&gt;
    &lt;span id="position"&gt;00:00&lt;/span&gt; / &lt;span id="duration"&gt;&lt;/span&gt;
&lt;/div&gt;
  &lt;div style="position:absolute;top:350px;display:none;"&gt;
   &lt;video width="848" height="480" loop&gt;
    &lt;source src="test.mp4" type="video/mp4"/&gt;
  &lt;/video&gt;

&lt;/div&gt;
&lt;div style="position:absolute;left:10px;top:50px;"&gt;
  &lt;canvas id="canvas1" width="320" height="180"&gt;&lt;/canvas&gt;
&lt;/div&gt;
&lt;div style="position:absolute;left:350px;top:50px;"&gt;
  &lt;canvas id="canvas2" width="320" height="180"&gt;&lt;/canvas&gt;
&lt;/div&gt;
&lt;div style="position:absolute;left:10px;top:250px;"&gt;
  &lt;canvas id="canvas3" width="320" height="180"&gt;&lt;/canvas&gt;
&lt;/div&gt;
&lt;div style="position:absolute;left:350px;top:250px;"&gt;
  &lt;canvas id="canvas4" width="320" height="180"&gt;&lt;/canvas&gt;
&lt;/div&gt;
&lt;div style="position:absolute;left:10px;top:450px;"&gt;
  &lt;canvas id="canvas5" width="320" height="180"&gt;&lt;/canvas&gt;
&lt;/div&gt;
&lt;div style="position:absolute;left:350px;top:450px;"&gt;
  &lt;canvas id="canvas6" width="320" height="180"&gt;&lt;/canvas&gt;
&lt;/div&gt;
&lt;script &gt;

    var addEvent = (function () {
        if (document.addEventListener) {
            return function (el, type, fn) {
                if (el &amp;&amp; el.nodeName || el === window) {
                    el.addEventListener(type, fn, false);
                } else if (el &amp;&amp; el.length) {
                    for (var i = 0; i &lt; el.length; i++) {
                        addEvent(el[i], type, fn);
                    }
                }
            };
        } else {
            return function (el, type, fn) {
                if (el &amp;&amp; el.nodeName || el === window) {
                    el.attachEvent('on' + type, function () { return fn.call(el, window.event); });
                } else if (el &amp;&amp; el.length) {
                    for (var i = 0; i &lt; el.length; i++) {
                        addEvent(el[i], type, fn);
                    }
                }
            };
        }
    })();

&lt;/script&gt;
&lt;script&gt;
    var video = document.querySelector('video');
    var togglePlay = document.querySelector('#play');
    var position = document.querySelector('#position');
    var canvas1 = document.querySelector('#canvas1');
    var ctx1 = canvas1.getContext('2d');
    var canvas2 = document.querySelector('#canvas2');
    var ctx2 = canvas2.getContext('2d');
    var canvas3 = document.querySelector('#canvas3');
    var ctx3 = canvas3.getContext('2d');
    var canvas4 = document.querySelector('#canvas4');
    var ctx4 = canvas4.getContext('2d');
    var canvas5 = document.querySelector('#canvas5');
    var ctx5 = canvas5.getContext('2d');
    var canvas6 = document.querySelector('#canvas6');
    var ctx6 = canvas6.getContext('2d');
var vleft=10;
var vtop=80;
var vmargin=4;
var vwidth=392;
var vheight=156;
var canvaswidth=320;
var canvasheight=180;
    addEvent(togglePlay, 'click', function () {
        //video.playbackRate = 1;
        if (video.paused) {
            if (video.ended) video.currentTime = 0;
            video.play();
            this.value = "pause";
        } else {
            video.pause();
            this.value = "play";
        }
    });

    setInterval(function () {
        position.innerHTML = asTime(video.currentTime);
        ctx1.drawImage(video, vleft,vtop, vwidth, vheight, 0,0, canvaswidth, canvasheight);
        ctx2.drawImage(video, vleft+vwidth+vmargin,vtop, vwidth, vheight, 0,0, canvaswidth, canvasheight);
        ctx3.drawImage(video, vleft+vwidth*2+vmargin,vtop, vwidth, vheight, 0,0, canvaswidth, canvasheight);
        ctx4.drawImage(video, vleft, vtop+vheight+vmargin, vwidth, vheight, 0,0, canvaswidth, canvasheight);
        ctx5.drawImage(video, vleft+vwidth+vmargin,vtop+vheight+vmargin, vwidth, vheight, 0,0, canvaswidth, canvasheight);
        ctx6.drawImage(video, vleft+vwidth*2+vmargin,vtop+vheight+vmargin, vwidth, vheight, 0,0, canvaswidth, canvasheight);
    }, 1000 / 25);

    addEvent(video, 'ended', function () {
        togglePlay.value = "play";
    });

    addEvent(video, 'canplay', function () {
        video.muted = true;
        document.querySelector('#duration').innerHTML = asTime(this.duration);
        startCanvas();
    });


    function startCanvas() {
        //canvas.setAttribute('height', Math.floor(video.height));
        //canvas.setAttribute('width', Math.floor(video.width));

        //ctx.translate(0, canvas.height );
        //ctx.scale(1, -1);
        //ctx.globalAlpha = 0.3;
        ctx1.drawImage(video, vleft,vtop, vwidth, vheight, 0,0, canvaswidth, canvasheight);
        ctx2.drawImage(video, vleft+vwidth+vmargin,vtop, vwidth, vheight, 0,0, canvaswidth, canvasheight);
        ctx3.drawImage(video, vleft+vwidth*2+vmargin,vtop, vwidth, vheight, 0,0, canvaswidth, canvasheight);
        ctx4.drawImage(video, vleft, vtop+vheight+vmargin, vwidth, vheight, 0,0, canvaswidth, canvasheight);
        ctx5.drawImage(video, vleft+vwidth+vmargin,vtop+vheight+vmargin, vwidth, vheight, 0,0, canvaswidth, canvasheight);
        ctx6.drawImage(video, vleft+vwidth*2+vmargin,vtop+vheight+vmargin, vwidth, vheight, 0,0, canvaswidth, canvasheight);


    }

    function asTime(t) {
        t = Math.round(t);
        var s = t % 60;
        var m = Math.round(t / 60);

        return two(m) + ':' + two(s);
    }

    function two(s) {
        s += "";
        if (s.length &lt; 2) s = "0" + s;
        return s;
    }
&lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre>

    </div>

  
    <ul class="tag_box inline">
      <li><i class="glyphicon glyphicon-open"></i></li>
      
      


  
     
    	<li><a href="/categories.html#web-ref">
    		web <span>8</span>
    	</a></li>
    
  


    </ul>
  

  
    <ul class="tag_box inline">
      <li><i class="glyphicon glyphicon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#html5-ref">html5 <span>2</span></a></li>
     
    	<li><a href="/tags.html#canvas-ref">canvas <span>2</span></a></li>
     
    	<li><a href="/tags.html#js-ref">js <span>3</span></a></li>
     
    	<li><a href="/tags.html#video-ref">video <span>1</span></a></li>
    
  



    </ul>
  

    <hr>
    <ul class="pagination">
    
      <li class="prev"><a href="/ios/2014/11/26/xcode-json-nsstring-convert" title="苹果iOS5下的的NSJSONSerialization类">上一篇</a></li>
    
      <li><a href="/archive.html">归档</a></li>
    
      <li class="next"><a href="/web/2014/11/27/opensource-js-css-framewok" title="开源的js/css框架（收集中）">下一篇</a></li>
    
    </ul>
    <hr>
    


  <div class="ds-thread" data-thread-key="/web/2014/11/27/html5-video-canvas-show" data-title="HTML5实现视频的分离显示" data-url="http://www.linchangyu.com/web/2014/11/27/html5-video-canvas-show"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"linchangyu"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>




  </div>
</div>


      </div>
      <div class="container">
        <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
        <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
      </div>
    </div>

    <div id="footer">
      <div class="container">
        <p>&copy; 2015 老林 with <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
        </p>
      </div>
    </div>

    



    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="http://lib.sinaapp.com/js/jquery/2.0.3/jquery-2.0.3.min.js"></script>
    <script src="/assets/themes/bootstrap-3/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>

