
<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>【028】系统设计：接口</title>
    <link rel="apple-touch-icon" href="/images/lcy.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/images/lcy.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/images/lcy.png" />
    
    
    <meta name="author" content="老林">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Sticky Footer -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bs-sticky-footer.css" rel="stylesheet">

    <!-- Custom styles -->
    <link href="/assets/themes/bootstrap-3/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?4785b99b80e16b513797fed0b7f9237d";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><img src="/images/lcy.png" width="64" height="64">风雨雷电堂</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive.html">日志</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">分类</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/projects.html">项目</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">标签</a></li>
      	
      
    
  




          </ul>
          <form class="navbar-form navbar-right" role="search" action="http://zhannei.baidu.com/cse/search" method="get" target="_blank">
          <input type="hidden" name="s" value="10670906174234479444"> <input type="hidden" name="entry" value="1">
            <div class="form-group">
              <input name="q" type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default">Submit</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1>【028】系统设计：接口  <small>Project No.028</small></h1>
</div>

<div class="row">
  <div class="col-xs-12">
    
<h2 id="section">规范</h2>

<h3 id="section-1">输入输出数据格式</h3>

<p>多字段统一使用body输入json格式数据</p>

<pre><code>{
    "body":
    {
        "username": "admin"
    }
}
</code></pre>

<p>接口统一返回json格式数据，文档中只提供成功返回数据的输出信息，默认信息统一使用以下json数据</p>

<pre><code>//通用正常返回信息
{
    "status":0,
    "info":"server is running."
}

//通用错误返回信息
{
    "status":-1,
    "info":"server is not running."
}
</code></pre>

<h3 id="section-2">接口类型</h3>

<ul>
  <li>ajax post：使用ajax post方式递交数据，返回json数据</li>
  <li>form post：使用form post方式递交数据，跳转指定URL</li>
</ul>

<h3 id="section-3">接口路径</h3>

<ul>
  <li>测试接口：http://123.57.52.186:8081/api/test/???.php</li>
  <li>线上接口：http://123.57.52.186:8081/api/1/???.php</li>
</ul>

<h2 id="section-4">接口列表</h2>

<h3 id="section-5">用户登录</h3>

<p>地址：http://123.57.52.186:8081/api/test/login.php</p>

<p>方法：ajax post</p>

<p>输入</p>

<pre><code>{
    "username":"13900000000",
    "password":"098f6bcd4621d373cade4e832627b4f6",
    "device":"e57b9648d9f0ca9620eff0fa42162273"
}
</code></pre>

<p>输出</p>

<pre><code>{
    "status": 0,
    "info": "success",
    "data": {
        "userid": "24",
        "unique_code": "16c7066322b351840508830ffdb037c9",
        "username": "18273191335"
    }
}
</code></pre>

<h3 id="section-6">用户注册</h3>

<p>地址：http://123.57.52.186:8081/api/test/register.php</p>

<p>方法：ajax post</p>

<p>输入</p>

<pre><code>{
    "username":"13900000000",
    "password":"098f6bcd4621d373cade4e832627b4f6",
    "device":"e57b9648d9f0ca9620eff0fa42162273"
}
</code></pre>

<p>输出</p>

<pre><code>{
    "status": 0,
    "info": "success",
    "data": {
        "userid": "24",
        "unique_code": "16c7066322b351840508830ffdb037c9",
        "username": "18273191335"
    }
}
</code></pre>

<h3 id="section-7">第三方用户登录</h3>

<p>地址：http://123.57.52.186:8081/api/test/third_login.php</p>

<p>方法：ajax post</p>

<p>输入</p>

<pre><code>{
    "platform":"wb|qq|wx",
    "uid":"098f6bcd4621d373cade4e832627b4f6",
    "nickname":"abc",
    "img":"http://xxx/xxx.jpg"
}
</code></pre>

<p>输出</p>

<pre><code>{
    "status":0,
    "info": "success",
    "data":
    {
        "userid": "24",
        "unique_code": "16c7066322b351840508830ffdb037c9",
        "username": "qq_24"
    }
}
</code></pre>

<h3 id="section-8">第三方用户再次登录</h3>

<p>地址：http://123.57.52.186:8081/api/test/third_login2.php</p>

<p>方法：ajax post</p>

<p>输入</p>

<pre><code>{
    "uid":"098f6bcd4621d373cade4e832627b4f6"
}
</code></pre>

<p>输出</p>

<pre><code>{
    "status":0,
    "info": "success",
    "data":
    {
        "userid": "24",
        "unique_code": "16c7066322b351840508830ffdb037c9",
        "username": "qq_24"
    }
}
</code></pre>

<h3 id="section-9">用户信息</h3>

<p>地址：http://123.57.52.186:8081/api/test/user_info.php</p>

<p>方法：ajax post</p>

<p>输入</p>

<pre><code>{
    "username":"13900000000",
    "unique_code":"098f6bcd4621d373cade4e832627b4f6"
}
</code></pre>

<p>输出</p>

<pre><code>{
    "status":0,
    "info":"ok",
    "userid":1,
    "username":"13900000000",
    "usericon":"http://xx.xxx.xxx.xxx/images/xx.png"
}
</code></pre>

<h3 id="section-10">用户修改头像</h3>

<p>地址：http://123.57.52.186:8081/api/test/user_update_icon.php</p>

<p>方法：ajax post</p>

<p>输入</p>

<pre><code>{
    "username":"13900000000",
    "unique_code":"098f6bcd4621d373cade4e832627b4f6"
    "image":"文件流"
}
</code></pre>

<p>输出</p>

<pre><code>{
    "status":0,
    "info":"ok",
    "usericon":"http://xx.xxx.xxx.xxx/images/xx.png"
}
</code></pre>

<h3 id="section-11">用户修改密码</h3>

<p>地址：http://123.57.52.186:8081/api/test/user_update_password.php</p>

<p>方法：ajax post</p>

<p>输入</p>

<pre><code>{
    "username":"13900000000",
    "unique_code":"098f6bcd4621d373cade4e832627b4f6",
    "password":"098f6bcd4621d373cade4e832627b4f6",
    "newpassword":"098f6bcd4621d373cade4e832627b4f6"
}
</code></pre>

<h3 id="section-12">根据坐标返回车位信息列表</h3>

<p>地址：http://123.57.52.186:8081/api/test/recommend.php</p>

<p>方法：ajax post</p>

<p>输入：</p>

<pre><code>{
    "latitude": 39.965628924686,
    "longitude": 116.36758000117,
    "range": 100,
    "page_size": 100,
    "page_num": 1
}

latitude	当前纬度
longitude	当前经度
range		范围半径（单位：米）
</code></pre>

<p>输出：</p>

<pre><code>{
    "status": 0,
    "info": "success",
    "data":
    [
    {
        "head_pic": "123.57.52.186:8081/d/file/parking/d9f17fa931fc61e93f1e3cd0499e08d6.png",
        "id": "1",
        "title": "北京交通大学",
        "addr": "北京交通大学",
        "is_change": "0",
        "distance": "100",
        "price_type": null,
        "price": "100"
    },
    {
        "head_pic": "123.57.52.186:8081/d/file/parking/d9f17fa931fc61e93f1e3cd0499e08d6.png",
        "id": "2",
        "title": "北京交通大学",
        "addr": "北京交通大学",
        "is_change": "0",
        "distance": "100",
        "price_type": null,
        "price": "100"
    }
    ]
}

head_pic	封面图片
id			车位ID
title		标题
addr		地址
is_change	是否置换
distance	距离
price		出租价格
</code></pre>

<blockquote>
  <p>注：首页定位后返回，如果没有取到对应区域中的有效数据，就返回最新的数据</p>
</blockquote>

<h3 id="section-13">图片上传接口</h3>

<p>地址：http://123.57.52.186:8081/api/test/addpics.php</p>

<p>方法：form post</p>

<p>输入</p>

<pre><code>{
    "images":"文件流"
}
</code></pre>

<p>处理</p>

<pre><code>var my_upload_images = $_COOKIE["my_upload_images"];
var my_upload_last = "http://xxx/xxx.jpg";
setcookie("my_upload_images", my_upload_images.','.my_upload_last, time()+3600);
header('Location: '.$_SERVER['HTTP_HOST'].'/h5/ud/fabucheweitupian.html');
exit;
</code></pre>

<h3 id="section-14">当前坐标上传接口</h3>

<p>地址：http://123.57.52.186:8081/api/test/mylocation.php</p>

<p>方法：ajax post</p>

<p>输入</p>

<pre><code>//存储
{
    "phone_code":"15074815411",
    "data":
    {
        "latitude": 39.965628924686,
        "longitude": 116.36758000117
    }
}

//不用cookie，使用memcache存储
//setcookie("my_latitude", "39.965628924686", time()+3600);
//setcookie("my_longitude", "116.36758000117", time()+3600);

//取出
{
    "phone_code":"15074815411"
}
</code></pre>

<p>输出（只输入phone_code时返回存储的值）</p>

<pre><code>{
    "status":0,
    "info":"ok",
    "latitude": 39.965628924686,
    "longitude": 116.36758000117
}
</code></pre>

<h3 id="section-15">发布车位</h3>

<p>地址：http://123.57.52.186:8081/api/test/parking.php</p>

<p>方法：ajax post</p>

<p>输入</p>

<pre><code>{
    "userid": 1,
    "unique_code": "abc",
    "address": "北京交通大学",
    "phonecode": "abc",
    "facilities": "1,2,3",
    "use_instruction": "test",
    "other_instruction": "other",
    "instruction": "instruction",
    "parking_num": 1,
    "day_num": 30,
    "trade_instruction": "trade_instruction",
    "wallet_type": "wallet_type",
    "is_change": 1,
    "wallet_num": "123abc",
    "phone_num": "110",
    "price_type": "123",
    "end_t": "2014-01-01",
    "start_t": "2015-12-30",
    "pics": "1，2，3，4",
    "is_refund": 1,
    "parking_type": "123",
    "parking_longitude": 116.354826,
    "price": 100,
    "have_invoice": -1,
    "parking_latitude": 39.958419
}

address             车位地址
phonecode           手机唯一标识符
facilities          配套设施
use_instruction     使用说明
other_instruction   其他说明
instruction         详细介绍
parking_num         车位数量
day_num             天数
trade_instruction   交易规则
wallet_type         收款账号类型
is_change           是否可置换
wallet_num          收款账号
phone_num           手机号码
price_type          价格类型
end_t               离开时间
start_t             入驻时间
pics                车位照片id集合
is_refund           是否可退款
parking_type        车位类型id
parking_latitude    车位GPS经度
parking_longitude   车位GPS纬度
price               价格
have_invoice        是否提供发票
userid              用户id
unique_code         用户登录后服务器返回的唯一标识符
</code></pre>

<h3 id="section-16">搜索车位</h3>

<p>地址：http://123.57.52.186:8081/api/test/search.php</p>

<p>方法：ajax post</p>

<p>输入</p>

<pre><code>{
    "latitude": 39.965628924686,
    "longitude": 116.36758000117,
    "radius": 1000,
    "page_index": 0,
    "page_size": 5,
    "q": "北京",
    "start_t": "2015-01-01",
    "end_t": "2015-09-09",
    "high_price": 1000,
    "low_price": "1",
    "parking_type": "",
    "is_change": 1
}

latitude        用户当前经度
longitude       用户当前纬度
radius          搜索范围，默认1000米
page_index      当前页的页标（翻页使用）
page_size       当前页面最大结果数
q               搜索关键词
start_t         开始时间
end_t           离开时间
high_price      最高单价
low_price       最低单价
parking_type    车位类型
is_change       搜索置换车位（1：是，其他值或者空：非置换搜索）
</code></pre>

<p>输出</p>

<pre><code>{
    "status": 0,
    "info": "success",
    "data": [
        {
            "head_pic": "123.57.52.186:8081/d/file/parking/d9f17fa931fc61e93f1e3cd0499e08d6.png",
            "id": "1",
            "title": "北京交通大学",
            "addr": "北京交通大学",
            "is_change": "0",
            "distance": "100",
            "price_type": null,
            "price": "100"
        },
        {
            "head_pic": "123.57.52.186:8081/d/file/parking/d9f17fa931fc61e93f1e3cd0499e08d6.png",
            "id": "2",
            "title": "北京交通大学",
            "addr": "北京交通大学",
            "is_change": "0",
            "distance": "100",
            "price_type": null,
            "price": "100"
        }
    ]
}
</code></pre>

<h3 id="section-17">车位详情</h3>

<p>地址：http://123.57.52.186:8081/api/test/parkinginfo.php</p>

<p>方法：ajax post</p>

<p>输入</p>

<pre><code>{
    "id": 81
}
</code></pre>

<p>输出</p>

<pre><code>{
    "status": 0,
    "info": "success",
    "data": [
    {
        "head_pic": "http://123.57.52.186:8081/d/file/parking/d9f17fa931fc61e93f1e3cd0499e08d6.png",
        "facilities": "",
        "parking_type": "露天",
        "wallet_type": "支付宝",
        "price_type": "元/日",
        "id": "81",
        "title": "长沙现代商贸城",
        "addr": "长沙现代商贸城",
        "is_change": "-1",
        "parking_num": "1",
        "parking_latitude": "39.958419",
        "parking_longitude": "116.354826",
        "instruction": "instruction",
        "other_instruction": "other",
        "pics": "abc",
        "have_invoice": "-1",
        "phone_num": "15989124145",
        "trade_instruction": "trade_instruction",
        "is_refund": "1",
        "start_t": "1451404800",
        "end_t": "1388505600",
        "day_num": "30",
        "use_instruction": "test",
        "price": "100"
    }
    ]
}
</code></pre>

  </div>
</div>


      </div>
      <div class="container">
        <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
        <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
      </div>
    </div>

    <div id="footer">
      <div class="container">
        <p>&copy; 2015 老林 with <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
        </p>
      </div>
    </div>
    



    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="http://lib.sinaapp.com/js/jquery/2.0.3/jquery-2.0.3.min.js"></script>
    <script src="/assets/themes/bootstrap-3/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>

